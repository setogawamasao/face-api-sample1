<!DOCTYPE html>
<html>
  <head>
    <script src="face-api.js"></script>
  </head>
  <body>
    <!-- メインキャンバス -->
    <div style="position: relative">
      <img id="inputImg" src="" style="max-width: 800px" />
      <canvas id="overlay" style="position: absolute; top: 0; left: 0"></canvas>
    </div>
    <!-- ファイルインプット -->
    <input
      id="uploadInput"
      type="file"
      style="position: absolute; bottom: 100px; left: 0"
      onchange="faceDetection()"
    />
    <script>
      faceDetection = async () => {
        // 画像セット
        const inputImgEl = document.getElementById("inputImg");
        const imgFile = document.getElementById("uploadInput").files[0];
        const img = await faceapi.bufferToImage(imgFile);
        inputImgEl.src = img.src;
        // 顔認証
        await faceapi.nets.ssdMobilenetv1.load("/");
        const options = new faceapi.SsdMobilenetv1Options({
          minConfidence: 0.5,
        });
        const results = await faceapi.detectAllFaces(inputImgEl, options);
        console.log(results);
        // 顔枠設定
        const canvas = document.getElementById("overlay");
        faceapi.matchDimensions(canvas, inputImgEl);
        faceapi.draw.drawDetections(
          canvas,
          faceapi.resizeResults(results, inputImgEl)
        );
      };
    </script>
  </body>
</html>
